const   BLACK               = 0x00,
        WHITE               = 0x01,
        RED                 = 0x02,
        CYAN                = 0x03,
        PURPLE              = 0x04,
        GREEN               = 0x05,
        BLUE                = 0x06,
        YELLOW              = 0x07,
        ORANGE              = 0x08,
        BROWN               = 0x09,
        PINK                = 0x0A,
        DARK_GREY           = 0x0B,
        GREY                = 0x0C,
        LIGHT_GREEN         = 0x0D,
        LIGHT_BLUE          = 0x0E,
        LIGHT_GREY          = 0x0F;

const   SCREENSIZEX         = 404,
        SCREENSIZEY         = 312;

const   OFFSETX             = 0x1f7 - 0x1e0 + 1;

function Palette16 ()
{
    return [
        "#000000", "#ffffff", "#bc5241", "#8feffb",
        "#b956eb", "#7edb40", "#553fe4", "#ffff77",
        "#c17b1d", "#826300", "#f49486", "#727272",
        "#a4a4a4", "#cdff98", "#9e8dff", "#d5d5d5"
    ];
}

function Charset ()
{
    return [
        0x3c, 0x66, 0x6e, 0x6e, 0x60, 0x62, 0x3c, 0x00, 0x18, 0x3c, 0x66, 0x7e,
        0x66, 0x66, 0x66, 0x00, 0x7c, 0x66, 0x66, 0x7c, 0x66, 0x66, 0x7c, 0x00,
        0x3c, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3c, 0x00, 0x78, 0x6c, 0x66, 0x66,
        0x66, 0x6c, 0x78, 0x00, 0x7e, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7e, 0x00,
        0x7e, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00, 0x3c, 0x66, 0x60, 0x6e,
        0x66, 0x66, 0x3c, 0x00, 0x66, 0x66, 0x66, 0x7e, 0x66, 0x66, 0x66, 0x00,
        0x3c, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x1e, 0x0c, 0x0c, 0x0c,
        0x0c, 0x6c, 0x38, 0x00, 0x66, 0x6c, 0x78, 0x70, 0x78, 0x6c, 0x66, 0x00,
        0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7e, 0x00, 0x63, 0x77, 0x7f, 0x6b,
        0x63, 0x63, 0x63, 0x00, 0x66, 0x76, 0x7e, 0x7e, 0x6e, 0x66, 0x66, 0x00,
        0x3c, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x00, 0x7c, 0x66, 0x66, 0x7c,
        0x60, 0x60, 0x60, 0x00, 0x3c, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x0e, 0x00,
        0x7c, 0x66, 0x66, 0x7c, 0x78, 0x6c, 0x66, 0x00, 0x3c, 0x66, 0x60, 0x3c,
        0x06, 0x66, 0x3c, 0x00, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00,
        0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x00, 0x66, 0x66, 0x66, 0x66,
        0x66, 0x3c, 0x18, 0x00, 0x63, 0x63, 0x63, 0x6b, 0x7f, 0x77, 0x63, 0x00,
        0x66, 0x66, 0x3c, 0x18, 0x3c, 0x66, 0x66, 0x00, 0x66, 0x66, 0x66, 0x3c,
        0x18, 0x18, 0x18, 0x00, 0x7e, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x7e, 0x00,
        0x3c, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3c, 0x00, 0x0c, 0x12, 0x30, 0x7c,
        0x30, 0x62, 0xfc, 0x00, 0x3c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x3c, 0x00,
        0x00, 0x18, 0x3c, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x00, 0x10, 0x30, 0x7f,
        0x7f, 0x30, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x18, 0x00, 0x66, 0x66, 0x66, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0xff, 0x66, 0xff, 0x66, 0x66, 0x00,
        0x18, 0x3e, 0x60, 0x3c, 0x06, 0x7c, 0x18, 0x00, 0x62, 0x66, 0x0c, 0x18,
        0x30, 0x66, 0x46, 0x00, 0x3c, 0x66, 0x3c, 0x38, 0x67, 0x66, 0x3f, 0x00,
        0x06, 0x0c, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x18, 0x30, 0x30,
        0x30, 0x18, 0x0c, 0x00, 0x30, 0x18, 0x0c, 0x0c, 0x0c, 0x18, 0x30, 0x00,
        0x00, 0x66, 0x3c, 0xff, 0x3c, 0x66, 0x00, 0x00, 0x00, 0x18, 0x18, 0x7e,
        0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30,
        0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x18, 0x18, 0x00, 0x00, 0x03, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x00,
        0x3c, 0x66, 0x6e, 0x76, 0x66, 0x66, 0x3c, 0x00, 0x18, 0x18, 0x38, 0x18,
        0x18, 0x18, 0x7e, 0x00, 0x3c, 0x66, 0x06, 0x0c, 0x30, 0x60, 0x7e, 0x00,
        0x3c, 0x66, 0x06, 0x1c, 0x06, 0x66, 0x3c, 0x00, 0x06, 0x0e, 0x1e, 0x66,
        0x7f, 0x06, 0x06, 0x00, 0x7e, 0x60, 0x7c, 0x06, 0x06, 0x66, 0x3c, 0x00,
        0x3c, 0x66, 0x60, 0x7c, 0x66, 0x66, 0x3c, 0x00, 0x7e, 0x66, 0x0c, 0x18,
        0x18, 0x18, 0x18, 0x00, 0x3c, 0x66, 0x66, 0x3c, 0x66, 0x66, 0x3c, 0x00,
        0x3c, 0x66, 0x66, 0x3e, 0x06, 0x66, 0x3c, 0x00, 0x00, 0x00, 0x18, 0x00,
        0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x18, 0x30,
        0x0e, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0e, 0x00, 0x00, 0x00, 0x7e, 0x00,
        0x7e, 0x00, 0x00, 0x00, 0x70, 0x18, 0x0c, 0x06, 0x0c, 0x18, 0x70, 0x00,
        0x3c, 0x66, 0x06, 0x0c, 0x18, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0xff,
        0xff, 0x00, 0x00, 0x00, 0x08, 0x1c, 0x3e, 0x7f, 0x7f, 0x1c, 0x3e, 0x00,
        0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0xff,
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00,
        0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xff, 0xff, 0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
        0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0xe0,
        0xf0, 0x38, 0x18, 0x18, 0x18, 0x18, 0x1c, 0x0f, 0x07, 0x00, 0x00, 0x00,
        0x18, 0x18, 0x38, 0xf0, 0xe0, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0xc0,
        0xc0, 0xc0, 0xff, 0xff, 0xc0, 0xe0, 0x70, 0x38, 0x1c, 0x0e, 0x07, 0x03,
        0x03, 0x07, 0x0e, 0x1c, 0x38, 0x70, 0xe0, 0xc0, 0xff, 0xff, 0xc0, 0xc0,
        0xc0, 0xc0, 0xc0, 0xc0, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
        0x00, 0x3c, 0x7e, 0x7e, 0x7e, 0x7e, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0xff, 0xff, 0x00, 0x36, 0x7f, 0x7f, 0x7f, 0x3e, 0x1c, 0x08, 0x00,
        0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00, 0x07,
        0x0f, 0x1c, 0x18, 0x18, 0xc3, 0xe7, 0x7e, 0x3c, 0x3c, 0x7e, 0xe7, 0xc3,
        0x00, 0x3c, 0x7e, 0x66, 0x66, 0x7e, 0x3c, 0x00, 0x18, 0x18, 0x66, 0x66,
        0x18, 0x18, 0x3c, 0x00, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06,
        0x08, 0x1c, 0x3e, 0x7f, 0x3e, 0x1c, 0x08, 0x00, 0x18, 0x18, 0x18, 0xff,
        0xff, 0x18, 0x18, 0x18, 0xc0, 0xc0, 0x30, 0x30, 0xc0, 0xc0, 0x30, 0x30,
        0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x03, 0x3e,
        0x76, 0x36, 0x36, 0x00, 0xff, 0x7f, 0x3f, 0x1f, 0x0f, 0x07, 0x03, 0x01,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0,
        0xf0, 0xf0, 0xf0, 0xf0, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
        0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0xff, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0,
        0xcc, 0xcc, 0x33, 0x33, 0xcc, 0xcc, 0x33, 0x33, 0x03, 0x03, 0x03, 0x03,
        0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0xcc, 0xcc, 0x33, 0x33,
        0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x80, 0x03, 0x03, 0x03, 0x03,
        0x03, 0x03, 0x03, 0x03, 0x18, 0x18, 0x18, 0x1f, 0x1f, 0x18, 0x18, 0x18,
        0x00, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x0f, 0x0f, 0x18, 0x18, 0x18, 0x1f,
        0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xf8, 0x18, 0x18, 0x18,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x1f,
        0x1f, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0xff, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0xff, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xf8,
        0xf8, 0x18, 0x18, 0x18, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0,
        0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x07, 0x07, 0x07, 0x07,
        0x07, 0x07, 0x07, 0x07, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0xff, 0xff,
        0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f,
        0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0xf8, 0xf8, 0x00, 0x00, 0x00,
        0xf0, 0xf0, 0xf0, 0xf0, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0,
        0x0f, 0x0f, 0x0f, 0x0f, 0xc3, 0x99, 0x91, 0x91, 0x9f, 0x99, 0xc3, 0xff,
        0xe7, 0xc3, 0x99, 0x81, 0x99, 0x99, 0x99, 0xff, 0x83, 0x99, 0x99, 0x83,
        0x99, 0x99, 0x83, 0xff, 0xc3, 0x99, 0x9f, 0x9f, 0x9f, 0x99, 0xc3, 0xff,
        0x87, 0x93, 0x99, 0x99, 0x99, 0x93, 0x87, 0xff, 0x81, 0x9f, 0x9f, 0x87,
        0x9f, 0x9f, 0x81, 0xff, 0x81, 0x9f, 0x9f, 0x87, 0x9f, 0x9f, 0x9f, 0xff,
        0xc3, 0x99, 0x9f, 0x91, 0x99, 0x99, 0xc3, 0xff, 0x99, 0x99, 0x99, 0x81,
        0x99, 0x99, 0x99, 0xff, 0xc3, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xc3, 0xff,
        0xe1, 0xf3, 0xf3, 0xf3, 0xf3, 0x93, 0xc7, 0xff, 0x99, 0x93, 0x87, 0x8f,
        0x87, 0x93, 0x99, 0xff, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f, 0x81, 0xff,
        0x9c, 0x88, 0x80, 0x94, 0x9c, 0x9c, 0x9c, 0xff, 0x99, 0x89, 0x81, 0x81,
        0x91, 0x99, 0x99, 0xff, 0xc3, 0x99, 0x99, 0x99, 0x99, 0x99, 0xc3, 0xff,
        0x83, 0x99, 0x99, 0x83, 0x9f, 0x9f, 0x9f, 0xff, 0xc3, 0x99, 0x99, 0x99,
        0x99, 0xc3, 0xf1, 0xff, 0x83, 0x99, 0x99, 0x83, 0x87, 0x93, 0x99, 0xff,
        0xc3, 0x99, 0x9f, 0xc3, 0xf9, 0x99, 0xc3, 0xff, 0x81, 0xe7, 0xe7, 0xe7,
        0xe7, 0xe7, 0xe7, 0xff, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xc3, 0xff,
        0x99, 0x99, 0x99, 0x99, 0x99, 0xc3, 0xe7, 0xff, 0x9c, 0x9c, 0x9c, 0x94,
        0x80, 0x88, 0x9c, 0xff, 0x99, 0x99, 0xc3, 0xe7, 0xc3, 0x99, 0x99, 0xff,
        0x99, 0x99, 0x99, 0xc3, 0xe7, 0xe7, 0xe7, 0xff, 0x81, 0xf9, 0xf3, 0xe7,
        0xcf, 0x9f, 0x81, 0xff, 0xc3, 0xcf, 0xcf, 0xcf, 0xcf, 0xcf, 0xc3, 0xff,
        0xf3, 0xed, 0xcf, 0x83, 0xcf, 0x9d, 0x03, 0xff, 0xc3, 0xf3, 0xf3, 0xf3,
        0xf3, 0xf3, 0xc3, 0xff, 0xff, 0xe7, 0xc3, 0x81, 0xe7, 0xe7, 0xe7, 0xe7,
        0xff, 0xef, 0xcf, 0x80, 0x80, 0xcf, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xe7, 0xe7, 0xe7, 0xe7, 0xff, 0xff, 0xe7, 0xff,
        0x99, 0x99, 0x99, 0xff, 0xff, 0xff, 0xff, 0xff, 0x99, 0x99, 0x00, 0x99,
        0x00, 0x99, 0x99, 0xff, 0xe7, 0xc1, 0x9f, 0xc3, 0xf9, 0x83, 0xe7, 0xff,
        0x9d, 0x99, 0xf3, 0xe7, 0xcf, 0x99, 0xb9, 0xff, 0xc3, 0x99, 0xc3, 0xc7,
        0x98, 0x99, 0xc0, 0xff, 0xf9, 0xf3, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xf3, 0xe7, 0xcf, 0xcf, 0xcf, 0xe7, 0xf3, 0xff, 0xcf, 0xe7, 0xf3, 0xf3,
        0xf3, 0xe7, 0xcf, 0xff, 0xff, 0x99, 0xc3, 0x00, 0xc3, 0x99, 0xff, 0xff,
        0xff, 0xe7, 0xe7, 0x81, 0xe7, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xe7, 0xe7, 0xcf, 0xff, 0xff, 0xff, 0x81, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0xe7, 0xe7, 0xff, 0xff, 0xfc, 0xf9, 0xf3,
        0xe7, 0xcf, 0x9f, 0xff, 0xc3, 0x99, 0x91, 0x89, 0x99, 0x99, 0xc3, 0xff,
        0xe7, 0xe7, 0xc7, 0xe7, 0xe7, 0xe7, 0x81, 0xff, 0xc3, 0x99, 0xf9, 0xf3,
        0xcf, 0x9f, 0x81, 0xff, 0xc3, 0x99, 0xf9, 0xe3, 0xf9, 0x99, 0xc3, 0xff,
        0xf9, 0xf1, 0xe1, 0x99, 0x80, 0xf9, 0xf9, 0xff, 0x81, 0x9f, 0x83, 0xf9,
        0xf9, 0x99, 0xc3, 0xff, 0xc3, 0x99, 0x9f, 0x83, 0x99, 0x99, 0xc3, 0xff,
        0x81, 0x99, 0xf3, 0xe7, 0xe7, 0xe7, 0xe7, 0xff, 0xc3, 0x99, 0x99, 0xc3,
        0x99, 0x99, 0xc3, 0xff, 0xc3, 0x99, 0x99, 0xc1, 0xf9, 0x99, 0xc3, 0xff,
        0xff, 0xff, 0xe7, 0xff, 0xff, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xe7, 0xff,
        0xff, 0xe7, 0xe7, 0xcf, 0xf1, 0xe7, 0xcf, 0x9f, 0xcf, 0xe7, 0xf1, 0xff,
        0xff, 0xff, 0x81, 0xff, 0x81, 0xff, 0xff, 0xff, 0x8f, 0xe7, 0xf3, 0xf9,
        0xf3, 0xe7, 0x8f, 0xff, 0xc3, 0x99, 0xf9, 0xf3, 0xe7, 0xff, 0xe7, 0xff,
        0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0xf7, 0xe3, 0xc1, 0x80,
        0x80, 0xe3, 0xc1, 0xff, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7,
        0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00,
        0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xcf, 0xcf, 0xcf, 0xcf,
        0xcf, 0xcf, 0xcf, 0xcf, 0xf3, 0xf3, 0xf3, 0xf3, 0xf3, 0xf3, 0xf3, 0xf3,
        0xff, 0xff, 0xff, 0x1f, 0x0f, 0xc7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe3, 0xf0,
        0xf8, 0xff, 0xff, 0xff, 0xe7, 0xe7, 0xc7, 0x0f, 0x1f, 0xff, 0xff, 0xff,
        0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x00, 0x00, 0x3f, 0x1f, 0x8f, 0xc7,
        0xe3, 0xf1, 0xf8, 0xfc, 0xfc, 0xf8, 0xf1, 0xe3, 0xc7, 0x8f, 0x1f, 0x3f,
        0x00, 0x00, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x00, 0x00, 0xfc, 0xfc,
        0xfc, 0xfc, 0xfc, 0xfc, 0xff, 0xc3, 0x81, 0x81, 0x81, 0x81, 0xc3, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xc9, 0x80, 0x80, 0x80,
        0xc1, 0xe3, 0xf7, 0xff, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f,
        0xff, 0xff, 0xff, 0xf8, 0xf0, 0xe3, 0xe7, 0xe7, 0x3c, 0x18, 0x81, 0xc3,
        0xc3, 0x81, 0x18, 0x3c, 0xff, 0xc3, 0x81, 0x99, 0x99, 0x81, 0xc3, 0xff,
        0xe7, 0xe7, 0x99, 0x99, 0xe7, 0xe7, 0xc3, 0xff, 0xf9, 0xf9, 0xf9, 0xf9,
        0xf9, 0xf9, 0xf9, 0xf9, 0xf7, 0xe3, 0xc1, 0x80, 0xc1, 0xe3, 0xf7, 0xff,
        0xe7, 0xe7, 0xe7, 0x00, 0x00, 0xe7, 0xe7, 0xe7, 0x3f, 0x3f, 0xcf, 0xcf,
        0x3f, 0x3f, 0xcf, 0xcf, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7,
        0xff, 0xff, 0xfc, 0xc1, 0x89, 0xc9, 0xc9, 0xff, 0x00, 0x80, 0xc0, 0xe0,
        0xf0, 0xf8, 0xfc, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xff, 0xff, 0xff, 0xff,
        0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x3f, 0x3f, 0x3f, 0x3f,
        0x3f, 0x3f, 0x3f, 0x3f, 0x33, 0x33, 0xcc, 0xcc, 0x33, 0x33, 0xcc, 0xcc,
        0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xff, 0xff, 0xff, 0xff,
        0x33, 0x33, 0xcc, 0xcc, 0x00, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f,
        0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xe7, 0xe7, 0xe7, 0xe0,
        0xe0, 0xe7, 0xe7, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xf0, 0xf0, 0xf0,
        0xe7, 0xe7, 0xe7, 0xe0, 0xe0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x07,
        0x07, 0xe7, 0xe7, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00,
        0xff, 0xff, 0xff, 0xe0, 0xe0, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0xe7, 0x00,
        0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xe7, 0xe7, 0xe7,
        0xe7, 0xe7, 0xe7, 0x07, 0x07, 0xe7, 0xe7, 0xe7, 0x3f, 0x3f, 0x3f, 0x3f,
        0x3f, 0x3f, 0x3f, 0x3f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f,
        0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0x00, 0x00, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff,
        0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xfc, 0xfc, 0xfc, 0xfc,
        0xfc, 0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x0f, 0x0f, 0x0f,
        0xf0, 0xf0, 0xf0, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xe7, 0xe7, 0xe7, 0x07,
        0x07, 0xff, 0xff, 0xff, 0x0f, 0x0f, 0x0f, 0x0f, 0xff, 0xff, 0xff, 0xff,
        0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0
    ];
}

class Canvas
{
    constructor ( id )
    {
        let _ = this;
        _.id = id;
        _.parent = document.getElementById( _.id );
        _.elem = document.createElement( "canvas" );
        _.parent.appendChild( _.elem );
        _.width = SCREENSIZEX;
        _.height = SCREENSIZEY;
        _.context = _.elem.getContext( "2d" );
        _.palette = new Palette16();
        _.scale();
    }

    drawRect ( x, y, width, height, color )
    {
        let _ = this,
            xpos = x,
            ypos = y;
        _.context.fillStyle = _.palette[color];
        _.context.fillRect( xpos, ypos, width, height);
    }

    plotPixel ( x, y, color )
    {
        let _ = this,
            xpos = x,
            ypos = y;
        _.context.fillStyle = _.palette[color];
        _.context.fillRect( xpos, ypos, _.pixelSize, _.pixelSize);
    }

    scale ()
    {
        let _ = this,
            parentStyle = getComputedStyle( _.parent ),
            parentWidth =
                parseFloat( parentStyle.width )
              - parseFloat( parentStyle.paddingLeft )
              - parseFloat( parentStyle.paddingRight ),
            scale = floor( ( parentWidth / _.width ), 1 );
        _.elem.width = _.width * scale;
        _.elem.height = _.height * scale;
        _.pixelSize = scale / 2;
        _.context.scale( scale, scale );
    }
}

function floor (value, decimals)
{
    return Number( Math.floor( value + "e" + decimals ) + "e-" + decimals );
}

function OutputArea ( id )
{
    let _ = this;
    _.id = id;
    _.elem = document.getElementById( _.id );
}

OutputArea.prototype.write = function ( string )
{
    let _ = this;
    _.elem.innerText += string + "\n";
}

function GenerateXmap ()
{
    let string = "_.xmap = { \"in\" : { ";
    for ( let i = 0; i < 24; i++ )
    {
        string += "\"" + ( 0x1e0 + i ) + "\": \""+ i + "\", ";
    }
    for ( let i = 0; i < 0x17c; i++ )
    {
        string += "\"" + i + "\" : \"" + ( i + 24 ) + "\", ";
    }
    string += " \"404\" : \"380\" } , \"out\" : { ";
    for ( let i = 0; i < 24; i++ )
    {
        string += "\"" + i + "\": \"" + ( 0x1e0 + i ) + "\", ";
    }
    for ( let i = 0; i < 0x17c; i++ )
    {
        string += "\"" + ( i + 24 ) + "\" : \"" + i + "\", ";
    }
    string += " \"380\" : \"404\" } }; ";
    return string;
}

function Vic ()
{
    constructor ()
    {
        let _ = this;
        _.base = 0xD000;
        _.registers = [     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // $D000 - $D007
                            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // $D008 - $D00F
                            0x00, 0x9B, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, // $D010 - $D017
                            0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // $D018 - $D01F
                            0x0E, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // $D020 - $D027
                            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00        // $D028 - $D02E
                        ];
    }

    read ( register )
    {
        let _ = this;
        if ( register >= _.base )
        {
            register -= _.base;
        }
        return _.registers[ register ];
    }

    write ( register, value )
    {
        let _ = this;
        if ( register >= _.base )
        {
            register -= _.base;
        }
        _.registers[ register ] = value;
    }
}

class C64Screen
{
    constructor ( id )
    {
        let _ = this;
        _.canvas = new Canvas( id );
        _.xmap = { "in" : { "480": "0", "481": "1", "482": "2", "483": "3", "484": "4", "485": "5", "486": "6", "487": "7", "488": "8", "489": "9", "490": "10", "491": "11", "492": "12", "493": "13", "494": "14", "495": "15", "496": "16", "497": "17", "498": "18", "499": "19", "500": "20", "501": "21", "502": "22", "503": "23", "0" : "24", "1" : "25", "2" : "26", "3" : "27", "4" : "28", "5" : "29", "6" : "30", "7" : "31", "8" : "32", "9" : "33", "10" : "34", "11" : "35", "12" : "36", "13" : "37", "14" : "38", "15" : "39", "16" : "40", "17" : "41", "18" : "42", "19" : "43", "20" : "44", "21" : "45", "22" : "46", "23" : "47", "24" : "48", "25" : "49", "26" : "50", "27" : "51", "28" : "52", "29" : "53", "30" : "54", "31" : "55", "32" : "56", "33" : "57", "34" : "58", "35" : "59", "36" : "60", "37" : "61", "38" : "62", "39" : "63", "40" : "64", "41" : "65", "42" : "66", "43" : "67", "44" : "68", "45" : "69", "46" : "70", "47" : "71", "48" : "72", "49" : "73", "50" : "74", "51" : "75", "52" : "76", "53" : "77", "54" : "78", "55" : "79", "56" : "80", "57" : "81", "58" : "82", "59" : "83", "60" : "84", "61" : "85", "62" : "86", "63" : "87", "64" : "88", "65" : "89", "66" : "90", "67" : "91", "68" : "92", "69" : "93", "70" : "94", "71" : "95", "72" : "96", "73" : "97", "74" : "98", "75" : "99", "76" : "100", "77" : "101", "78" : "102", "79" : "103", "80" : "104", "81" : "105", "82" : "106", "83" : "107", "84" : "108", "85" : "109", "86" : "110", "87" : "111", "88" : "112", "89" : "113", "90" : "114", "91" : "115", "92" : "116", "93" : "117", "94" : "118", "95" : "119", "96" : "120", "97" : "121", "98" : "122", "99" : "123", "100" : "124", "101" : "125", "102" : "126", "103" : "127", "104" : "128", "105" : "129", "106" : "130", "107" : "131", "108" : "132", "109" : "133", "110" : "134", "111" : "135", "112" : "136", "113" : "137", "114" : "138", "115" : "139", "116" : "140", "117" : "141", "118" : "142", "119" : "143", "120" : "144", "121" : "145", "122" : "146", "123" : "147", "124" : "148", "125" : "149", "126" : "150", "127" : "151", "128" : "152", "129" : "153", "130" : "154", "131" : "155", "132" : "156", "133" : "157", "134" : "158", "135" : "159", "136" : "160", "137" : "161", "138" : "162", "139" : "163", "140" : "164", "141" : "165", "142" : "166", "143" : "167", "144" : "168", "145" : "169", "146" : "170", "147" : "171", "148" : "172", "149" : "173", "150" : "174", "151" : "175", "152" : "176", "153" : "177", "154" : "178", "155" : "179", "156" : "180", "157" : "181", "158" : "182", "159" : "183", "160" : "184", "161" : "185", "162" : "186", "163" : "187", "164" : "188", "165" : "189", "166" : "190", "167" : "191", "168" : "192", "169" : "193", "170" : "194", "171" : "195", "172" : "196", "173" : "197", "174" : "198", "175" : "199", "176" : "200", "177" : "201", "178" : "202", "179" : "203", "180" : "204", "181" : "205", "182" : "206", "183" : "207", "184" : "208", "185" : "209", "186" : "210", "187" : "211", "188" : "212", "189" : "213", "190" : "214", "191" : "215", "192" : "216", "193" : "217", "194" : "218", "195" : "219", "196" : "220", "197" : "221", "198" : "222", "199" : "223", "200" : "224", "201" : "225", "202" : "226", "203" : "227", "204" : "228", "205" : "229", "206" : "230", "207" : "231", "208" : "232", "209" : "233", "210" : "234", "211" : "235", "212" : "236", "213" : "237", "214" : "238", "215" : "239", "216" : "240", "217" : "241", "218" : "242", "219" : "243", "220" : "244", "221" : "245", "222" : "246", "223" : "247", "224" : "248", "225" : "249", "226" : "250", "227" : "251", "228" : "252", "229" : "253", "230" : "254", "231" : "255", "232" : "256", "233" : "257", "234" : "258", "235" : "259", "236" : "260", "237" : "261", "238" : "262", "239" : "263", "240" : "264", "241" : "265", "242" : "266", "243" : "267", "244" : "268", "245" : "269", "246" : "270", "247" : "271", "248" : "272", "249" : "273", "250" : "274", "251" : "275", "252" : "276", "253" : "277", "254" : "278", "255" : "279", "256" : "280", "257" : "281", "258" : "282", "259" : "283", "260" : "284", "261" : "285", "262" : "286", "263" : "287", "264" : "288", "265" : "289", "266" : "290", "267" : "291", "268" : "292", "269" : "293", "270" : "294", "271" : "295", "272" : "296", "273" : "297", "274" : "298", "275" : "299", "276" : "300", "277" : "301", "278" : "302", "279" : "303", "280" : "304", "281" : "305", "282" : "306", "283" : "307", "284" : "308", "285" : "309", "286" : "310", "287" : "311", "288" : "312", "289" : "313", "290" : "314", "291" : "315", "292" : "316", "293" : "317", "294" : "318", "295" : "319", "296" : "320", "297" : "321", "298" : "322", "299" : "323", "300" : "324", "301" : "325", "302" : "326", "303" : "327", "304" : "328", "305" : "329", "306" : "330", "307" : "331", "308" : "332", "309" : "333", "310" : "334", "311" : "335", "312" : "336", "313" : "337", "314" : "338", "315" : "339", "316" : "340", "317" : "341", "318" : "342", "319" : "343", "320" : "344", "321" : "345", "322" : "346", "323" : "347", "324" : "348", "325" : "349", "326" : "350", "327" : "351", "328" : "352", "329" : "353", "330" : "354", "331" : "355", "332" : "356", "333" : "357", "334" : "358", "335" : "359", "336" : "360", "337" : "361", "338" : "362", "339" : "363", "340" : "364", "341" : "365", "342" : "366", "343" : "367", "344" : "368", "345" : "369", "346" : "370", "347" : "371", "348" : "372", "349" : "373", "350" : "374", "351" : "375", "352" : "376", "353" : "377", "354" : "378", "355" : "379", "356" : "380", "357" : "381", "358" : "382", "359" : "383", "360" : "384", "361" : "385", "362" : "386", "363" : "387", "364" : "388", "365" : "389", "366" : "390", "367" : "391", "368" : "392", "369" : "393", "370" : "394", "371" : "395", "372" : "396", "373" : "397", "374" : "398", "375" : "399", "376" : "400", "377" : "401", "378" : "402", "379" : "403", "404" : "380" } , "out" : { "0": "480", "1": "481", "2": "482", "3": "483", "4": "484", "5": "485", "6": "486", "7": "487", "8": "488", "9": "489", "10": "490", "11": "491", "12": "492", "13": "493", "14": "494", "15": "495", "16": "496", "17": "497", "18": "498", "19": "499", "20": "500", "21": "501", "22": "502", "23": "503", "24" : "0", "25" : "1", "26" : "2", "27" : "3", "28" : "4", "29" : "5", "30" : "6", "31" : "7", "32" : "8", "33" : "9", "34" : "10", "35" : "11", "36" : "12", "37" : "13", "38" : "14", "39" : "15", "40" : "16", "41" : "17", "42" : "18", "43" : "19", "44" : "20", "45" : "21", "46" : "22", "47" : "23", "48" : "24", "49" : "25", "50" : "26", "51" : "27", "52" : "28", "53" : "29", "54" : "30", "55" : "31", "56" : "32", "57" : "33", "58" : "34", "59" : "35", "60" : "36", "61" : "37", "62" : "38", "63" : "39", "64" : "40", "65" : "41", "66" : "42", "67" : "43", "68" : "44", "69" : "45", "70" : "46", "71" : "47", "72" : "48", "73" : "49", "74" : "50", "75" : "51", "76" : "52", "77" : "53", "78" : "54", "79" : "55", "80" : "56", "81" : "57", "82" : "58", "83" : "59", "84" : "60", "85" : "61", "86" : "62", "87" : "63", "88" : "64", "89" : "65", "90" : "66", "91" : "67", "92" : "68", "93" : "69", "94" : "70", "95" : "71", "96" : "72", "97" : "73", "98" : "74", "99" : "75", "100" : "76", "101" : "77", "102" : "78", "103" : "79", "104" : "80", "105" : "81", "106" : "82", "107" : "83", "108" : "84", "109" : "85", "110" : "86", "111" : "87", "112" : "88", "113" : "89", "114" : "90", "115" : "91", "116" : "92", "117" : "93", "118" : "94", "119" : "95", "120" : "96", "121" : "97", "122" : "98", "123" : "99", "124" : "100", "125" : "101", "126" : "102", "127" : "103", "128" : "104", "129" : "105", "130" : "106", "131" : "107", "132" : "108", "133" : "109", "134" : "110", "135" : "111", "136" : "112", "137" : "113", "138" : "114", "139" : "115", "140" : "116", "141" : "117", "142" : "118", "143" : "119", "144" : "120", "145" : "121", "146" : "122", "147" : "123", "148" : "124", "149" : "125", "150" : "126", "151" : "127", "152" : "128", "153" : "129", "154" : "130", "155" : "131", "156" : "132", "157" : "133", "158" : "134", "159" : "135", "160" : "136", "161" : "137", "162" : "138", "163" : "139", "164" : "140", "165" : "141", "166" : "142", "167" : "143", "168" : "144", "169" : "145", "170" : "146", "171" : "147", "172" : "148", "173" : "149", "174" : "150", "175" : "151", "176" : "152", "177" : "153", "178" : "154", "179" : "155", "180" : "156", "181" : "157", "182" : "158", "183" : "159", "184" : "160", "185" : "161", "186" : "162", "187" : "163", "188" : "164", "189" : "165", "190" : "166", "191" : "167", "192" : "168", "193" : "169", "194" : "170", "195" : "171", "196" : "172", "197" : "173", "198" : "174", "199" : "175", "200" : "176", "201" : "177", "202" : "178", "203" : "179", "204" : "180", "205" : "181", "206" : "182", "207" : "183", "208" : "184", "209" : "185", "210" : "186", "211" : "187", "212" : "188", "213" : "189", "214" : "190", "215" : "191", "216" : "192", "217" : "193", "218" : "194", "219" : "195", "220" : "196", "221" : "197", "222" : "198", "223" : "199", "224" : "200", "225" : "201", "226" : "202", "227" : "203", "228" : "204", "229" : "205", "230" : "206", "231" : "207", "232" : "208", "233" : "209", "234" : "210", "235" : "211", "236" : "212", "237" : "213", "238" : "214", "239" : "215", "240" : "216", "241" : "217", "242" : "218", "243" : "219", "244" : "220", "245" : "221", "246" : "222", "247" : "223", "248" : "224", "249" : "225", "250" : "226", "251" : "227", "252" : "228", "253" : "229", "254" : "230", "255" : "231", "256" : "232", "257" : "233", "258" : "234", "259" : "235", "260" : "236", "261" : "237", "262" : "238", "263" : "239", "264" : "240", "265" : "241", "266" : "242", "267" : "243", "268" : "244", "269" : "245", "270" : "246", "271" : "247", "272" : "248", "273" : "249", "274" : "250", "275" : "251", "276" : "252", "277" : "253", "278" : "254", "279" : "255", "280" : "256", "281" : "257", "282" : "258", "283" : "259", "284" : "260", "285" : "261", "286" : "262", "287" : "263", "288" : "264", "289" : "265", "290" : "266", "291" : "267", "292" : "268", "293" : "269", "294" : "270", "295" : "271", "296" : "272", "297" : "273", "298" : "274", "299" : "275", "300" : "276", "301" : "277", "302" : "278", "303" : "279", "304" : "280", "305" : "281", "306" : "282", "307" : "283", "308" : "284", "309" : "285", "310" : "286", "311" : "287", "312" : "288", "313" : "289", "314" : "290", "315" : "291", "316" : "292", "317" : "293", "318" : "294", "319" : "295", "320" : "296", "321" : "297", "322" : "298", "323" : "299", "324" : "300", "325" : "301", "326" : "302", "327" : "303", "328" : "304", "329" : "305", "330" : "306", "331" : "307", "332" : "308", "333" : "309", "334" : "310", "335" : "311", "336" : "312", "337" : "313", "338" : "314", "339" : "315", "340" : "316", "341" : "317", "342" : "318", "343" : "319", "344" : "320", "345" : "321", "346" : "322", "347" : "323", "348" : "324", "349" : "325", "350" : "326", "351" : "327", "352" : "328", "353" : "329", "354" : "330", "355" : "331", "356" : "332", "357" : "333", "358" : "334", "359" : "335", "360" : "336", "361" : "337", "362" : "338", "363" : "339", "364" : "340", "365" : "341", "366" : "342", "367" : "343", "368" : "344", "369" : "345", "370" : "346", "371" : "347", "372" : "348", "373" : "349", "374" : "350", "375" : "351", "376" : "352", "377" : "353", "378" : "354", "379" : "355", "380" : "356", "381" : "357", "382" : "358", "383" : "359", "384" : "360", "385" : "361", "386" : "362", "387" : "363", "388" : "364", "389" : "365", "390" : "366", "391" : "367", "392" : "368", "393" : "369", "394" : "370", "395" : "371", "396" : "372", "397" : "373", "398" : "374", "399" : "375", "400" : "376", "401" : "377", "402" : "378", "403" : "379", "380" : "404" } };
        _.init( LIGHT_BLUE, BLUE, LIGHT_BLUE );
    }

    init ( borderColor, backgroundColor, textColor )
    {
        let _ = this;
    }
}

let screen = new C64Screen( "canvas2d" );
